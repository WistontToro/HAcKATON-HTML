<!DOCTYPE html>
<html lang="es-CO">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel Supervisor ‚Äî Conciencia Digital</title>
  <meta name="description" content="Panel para supervisores ‚Äî Conciencia Digital">
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="style.css">
  <style>
    /* estilos espec√≠ficos para el dashboard del supervisor (coherentes con style.css) */
    .dashboard-header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0}
    .header-left{display:flex;align-items:center;gap:12px}
    .profile-dropdown{position:relative}
    .profile-btn{display:flex;align-items:center;gap:8px;background:var(--card);border-radius:10px;padding:6px 10px;cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .profile-menu{position:absolute;top:calc(100% + 8px);left:0;background:var(--card);border-radius:10px;padding:8px;box-shadow:0 12px 28px rgba(2,6,12,0.6);display:none;min-width:180px;z-index:30}
    .profile-menu a{display:block;padding:8px;border-radius:8px;color:var(--muted);text-decoration:none}
    .profile-menu a:hover{background:rgba(255,255,255,0.02);color:var(--text)}

    .header-actions{display:flex;align-items:center;gap:10px}
    .icon-btn{background:var(--card);border-radius:10px;padding:8px;cursor:pointer;border:1px solid rgba(255,255,255,0.03);display:inline-flex;align-items:center;gap:8px}
    .icon-btn .count-badge{background:#ffb4b4;color:#042027;padding:2px 6px;border-radius:12px;font-size:12px;margin-left:6px}

    .dashboard-main{display:flex;gap:18px;margin-top:18px}
    .left-panel{width:300px;background:var(--card);padding:16px;border-radius:12px}
    .content-panel{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;position:relative;min-height:420px}

    .menu-item{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;cursor:pointer;background:var(--glass);margin-bottom:10px;border:1px solid transparent}
    .menu-item.active{box-shadow:0 10px 30px rgba(2,6,12,0.45);border-color:rgba(255,255,255,0.03)}

    /* layout inside option 1 */
    .students-list{display:flex;flex-direction:column;gap:8px;max-height:420px;overflow:auto}
    .student-row{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}
    .student-row:hover{background:rgba(255,255,255,0.03)}
    .student-row.selected{outline:2px solid rgba(0,150,136,0.12);background:rgba(0,150,136,0.03)}

    .detail-card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 8px 28px rgba(2,6,12,0.45)}
    .small-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}

    .comments-box{margin-top:12px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);min-height:80px}
    .comment{padding:8px;border-radius:6px;background:rgba(255,255,255,0.01);margin-bottom:6px}

    /* option 2: table */
    table.stats{width:100%;border-collapse:collapse;margin-top:12px}
    table.stats th, table.stats td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
    .metric{font-weight:700;font-size:18px}

    /* option 3: comment cards */
    .cards-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .card-comment{background:var(--card);padding:12px;border-radius:8px;min-height:100px}

    .muted-note{color:var(--muted);padding:12px}
    @media (max-width:980px){
      .dashboard-main{flex-direction:column}
      .left-panel{width:100%}
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="dashboard-header" role="banner">
      <div class="header-left">
        <div class="brand" aria-hidden="false">
          <div class="logo" aria-hidden="true">CD</div>
          <div class="brand-text" style="margin-left:8px">
            <strong>Conciencia Digital</strong><br>
            <small class="muted">Panel Supervisor</small>
          </div>
        </div>

        <div class="profile-dropdown" id="profileDropdown">
          <button class="profile-btn" id="profileBtn" aria-haspopup="true" aria-expanded="false">
            <div style="width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700">S</div>
            <div>
              <div style="font-weight:700">Supervisor</div>
              <div class="muted" style="font-size:12px">Equipo</div>
            </div>
            <div style="margin-left:8px;color:var(--muted)">‚ñæ</div>
          </button>
          <div class="profile-menu" id="profileMenu" role="menu" aria-hidden="true">
            <a href="#" role="menuitem">Cuenta</a>
            <a href="#" role="menuitem">Perfil</a>
            <a href="#" role="menuitem">Configuraciones</a>
            <a href="#" role="menuitem">Cerrar sesi√≥n</a>
          </div>
        </div>
      </div>

      <div class="header-actions" aria-hidden="false">
        <button class="icon-btn" id="helpBtn" title="Ayuda">‚ùì Ayuda</button>
        <button class="icon-btn" id="notifBtn" title="Notificaciones">üîî <span class="count-badge" id="notifCount">2</span></button>
        <button class="icon-btn" id="statsBtn" title="Estad√≠sticas">üìä Estad√≠sticas</button>
      </div>
    </header>

    <div class="dashboard-main" role="main">
      <aside class="left-panel" aria-label="Opciones">
        <div style="font-weight:700;margin-bottom:10px">Supervisor</div>

        <div id="menuList" class="menu-item" data-section="list" tabindex="0">
          <div>
            <h4>Lista de estudiantes</h4>
            <p class="muted">Ver detalle y comentarios</p>
          </div>
          <div>‚óè</div>
        </div>

        <div id="menuStats" class="menu-item" data-section="stats" tabindex="0">
          <div>
            <h4>Estad√≠sticas</h4>
            <p class="muted">Media y mediana (simulado)</p>
          </div>
          <div>‚óè</div>
        </div>

        <div id="menuComments" class="menu-item" data-section="comments" tabindex="0">
          <div>
            <h4>Comentarios</h4>
            <p class="muted">Revisi√≥n r√°pida de comentarios</p>
          </div>
          <div>‚óè</div>
        </div>
      </aside>

      <section class="content-panel" aria-live="polite">
        <!-- IMPORTANT: On initial load the right container is intentionally empty.
             Sections are present in DOM but hidden until selected. -->
        <!-- LIST SECTION -->
        <div id="list" class="section" style="display:none">
          <h2>Lista de estudiantes</h2>
          <p class="muted">Haz clic en un estudiante para ver su informaci√≥n y comentarios (simulado).</p>

          <div style="display:flex;gap:16px;margin-top:12px;flex-wrap:wrap">
            <div style="width:360px">
              <div style="font-weight:700;margin-bottom:8px">Estudiantes</div>
              <div class="students-list" id="studentsList" role="list"></div>
            </div>

            <div style="flex:1;min-width:320px">
              <!-- detail card hidden until a student is selected -->
              <div class="detail-card" id="studentDetail" style="display:none">
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div>
                    <div id="detailName" style="font-weight:800;font-size:18px">Nombre</div>
                    <div id="detailSchool" class="muted" style="margin-top:6px"></div>
                  </div>
                </div>

                <div class="small-grid" style="margin-top:12px">
                  <div>
                    <div class="muted">Cantidad de evaluados</div>
                    <div class="metric" id="detailEvalCount">‚Äî</div>
                  </div>
                  <div>
                    <div class="muted">Promedio ex√°menes de evaluados</div>
                    <div class="metric" id="detailEvalAvg">‚Äî</div>
                  </div>
                </div>

                <div style="margin-top:10px">
                  <div class="muted">Calificaci√≥n propia (promedio)</div>
                  <div class="metric" id="detailOwnAvg">‚Äî</div>
                </div>

                <div style="margin-top:12px">
                  <div class="muted">Comentarios (aparecen uno a uno)</div>
                  <div class="comments-box" id="detailComments">
                    <div class="muted">No hay comentarios seleccionados.</div>
                  </div>
                </div>
              </div>

              <!-- note shown when list is displayed but no student selected -->
              <div id="noSelectionNote" class="muted-note" style="display:none">Selecciona un estudiante para ver detalles.</div>
            </div>
          </div>
        </div>

        <!-- STATS SECTION -->
        <div id="stats" class="section" style="display:none">
          <h2>Estad√≠sticas de los alumnos</h2>
          <p class="muted">Media y mediana por estudiante y global (simulado).</p>

          <div id="statsArea" style="margin-top:12px">
            <div style="display:flex;gap:14px;flex-wrap:wrap">
              <div class="detail-card" style="min-width:220px">
                <div class="muted">Media global de ex√°menes</div>
                <div class="metric" id="globalMean">‚Äî</div>
                <div class="muted small" id="globalExtra"></div>
              </div>
              <div class="detail-card" style="min-width:220px">
                <div class="muted">Mediana global</div>
                <div class="metric" id="globalMedian">‚Äî</div>
              </div>
            </div>

            <table class="stats" aria-describedby="statsTableDesc">
              <caption id="statsTableDesc" class="muted">Tabla con media y mediana por estudiante (simulado)</caption>
              <thead>
                <tr><th>Estudiante</th><th>Promedio propio</th><th>Promedio de evaluados</th><th>Mediana evaluados</th></tr>
              </thead>
              <tbody id="statsTbody"></tbody>
            </table>
          </div>
        </div>

        <!-- COMMENTS SECTION -->
        <div id="comments" class="section" style="display:none">
          <h2>Comentarios y recomendaciones (visi√≥n r√°pida)</h2>
          <p class="muted">Comentarios agregados por estudiantes ‚Äî simulados. Se mostrar√°n en peque√±os recuadros uno por uno cada 2 segundos.</p>

          <div class="cards-grid" id="commentsGrid" style="margin-top:12px">
            <!-- cards appended here sequentially -->
          </div>
        </div>
        <!-- end content-panel -->
      </section>
    </div>
  </div>

  <script>
    /***********************
     * Simulated data
     ***********************/
    const students = [
      {
        id: 'STU-A',
        name: 'Ana Morales',
        school: 'Colegio San Jos√©',
        grade: '10¬∞',
        numEvaluados: 7,
        avgEvaluados: 78.2,
        avgOwn: 82.5,
        comments: [
          'Muy buena explicaci√≥n en la charla.',
          'El material fue claro y did√°ctico.',
          'Ser√≠a √∫til m√°s ejemplos pr√°cticos.'
        ]
      },
      {
        id: 'STU-B',
        name: 'Carlos Rueda',
        school: 'Instituto Central',
        grade: '11¬∞',
        numEvaluados: 12,
        avgEvaluados: 72.3,
        avgOwn: 75.0,
        comments: [
          'Algunos evaluados no comprendieron la parte de verificaci√≥n.',
          'Buen enfoque en ciberbullying.',
          'Pedir√≠a m√°s tiempo para las actividades.'
        ]
      },
      {
        id: 'STU-C',
        name: 'Wiston Toro',
        school: 'Instituci√≥n Demo',
        grade: '11¬∞',
        numEvaluados: 5,
        avgEvaluados: 85.6,
        avgOwn: 88.9,
        comments: [
          'Excelente dinamismo en la presentaci√≥n.',
          'Las actividades fueron interactivas.',
          'Pocos recursos visuales, podr√≠an mejorar.'
        ]
      },
      {
        id: 'STU-D',
        name: 'Luc√≠a Fern√°ndez',
        school: 'Colegio Nacional',
        grade: '9¬∞',
        numEvaluados: 3,
        avgEvaluados: 65.1,
        avgOwn: 70.4,
        comments: [
          'Necesita m√°s pr√°ctica en la parte de verificaci√≥n de im√°genes.',
          'Los ejemplos locales ayudaron mucho.'
        ]
      }
    ];

    /***********************
     * Header dropdown
     ***********************/
    const profileBtn = document.getElementById('profileBtn');
    const profileMenu = document.getElementById('profileMenu');
    profileBtn.addEventListener('click', () => {
      const exp = profileBtn.getAttribute('aria-expanded') === 'true';
      profileBtn.setAttribute('aria-expanded', String(!exp));
      profileMenu.style.display = exp ? 'none' : 'block';
      profileMenu.setAttribute('aria-hidden', exp ? 'true' : 'false');
    });
    document.addEventListener('click', (e) => {
      if(!profileBtn.contains(e.target) && !profileMenu.contains(e.target)){
        profileMenu.style.display = 'none';
        profileBtn.setAttribute('aria-expanded', 'false');
      }
    });

    /***********************
     * Navigation left menu
     ***********************/
    const menuItems = {
      list: document.getElementById('menuList'),
      stats: document.getElementById('menuStats'),
      comments: document.getElementById('menuComments')
    };
    const sections = {
      list: document.getElementById('list'),
      stats: document.getElementById('stats'),
      comments: document.getElementById('comments')
    };

    // intervals handles for comment cycles
    let detailCommentInterval = null;
    let commentsGridInterval = null;

    function clearAllIntervals(){
      if(detailCommentInterval){ clearInterval(detailCommentInterval); detailCommentInterval = null; }
      if(commentsGridInterval){ clearInterval(commentsGridInterval); commentsGridInterval = null; }
    }

    function hideAllSections(){
      Object.values(sections).forEach(s => { s.style.display = 'none'; });
      // clear intervals and UI areas
      clearAllIntervals();
      // clear comments grid
      document.getElementById('commentsGrid').innerHTML = '';
      // hide any detail card and show default note hidden by default
      hideDetail();
    }

    function showSection(name){
      // deactivate menu highlight
      Object.values(menuItems).forEach(mi => mi.classList.remove('active'));
      menuItems[name].classList.add('active');

      // hide everything first
      hideAllSections();

      // show the requested section and run its render logic
      const sec = sections[name];
      sec.style.display = 'block';

      if(name === 'list'){
        // render only the list; detail hidden until selection
        renderStudentsList();
        // ensure noSelectionNote visible and detail hidden
        document.getElementById('noSelectionNote').style.display = 'block';
        document.getElementById('studentDetail').style.display = 'none';
      } else if(name === 'stats'){
        renderStats();
      } else if(name === 'comments'){
        // start sequential display of comment cards
        renderCommentsSequential();
      }
    }

    Object.entries(menuItems).forEach(([name, el])=>{
      el.addEventListener('click', ()=> showSection(name));
      el.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') showSection(name); });
    });

    /***********************
     * OPTION 1: render students list and detail
     ***********************/
    const studentsListEl = document.getElementById('studentsList');
    const detailCardEl = document.getElementById('studentDetail');
    const noSelectionNote = document.getElementById('noSelectionNote');
    const detailName = document.getElementById('detailName');
    const detailSchool = document.getElementById('detailSchool');
    const detailEvalCount = document.getElementById('detailEvalCount');
    const detailEvalAvg = document.getElementById('detailEvalAvg');
    const detailOwnAvg = document.getElementById('detailOwnAvg');
    const detailComments = document.getElementById('detailComments');
    let currentCommentIndex = 0;
    let selectedStudentId = null;

    function renderStudentsList(){
      studentsListEl.innerHTML = '';
      students.forEach(s => {
        const row = document.createElement('div');
        row.className = 'student-row';
        row.tabIndex = 0;
        row.setAttribute('data-id', s.id);
        row.innerHTML = `<div>
                           <div style="font-weight:700">${s.name}</div>
                           <div class="muted" style="font-size:13px">${s.school} ‚Ä¢ ${s.grade}</div>
                         </div>
                         <div class="muted" style="font-size:13px">${s.numEvaluados} eval.</div>`;
        row.addEventListener('click', ()=> selectStudent(s.id));
        row.addEventListener('keydown', (e)=> { if(e.key === 'Enter') selectStudent(s.id); });
        studentsListEl.appendChild(row);
      });
    }

    function selectStudent(id){
      // stop other comment cycles
      stopDetailCommentsCycle();
      selectedStudentId = id;
      const s = students.find(x=>x.id===id);
      if(!s) return;
      // mark selection visually
      document.querySelectorAll('.student-row').forEach(r => r.classList.remove('selected'));
      const selectedRow = document.querySelector(`.student-row[data-id="${id}"]`);
      if(selectedRow) selectedRow.classList.add('selected');

      // show detail panel, hide the no-selection note
      detailCardEl.style.display = 'block';
      noSelectionNote.style.display = 'none';

      detailName.textContent = s.name;
      detailSchool.textContent = `${s.school} ‚Ä¢ ${s.grade}`;
      detailEvalCount.textContent = s.numEvaluados;
      detailEvalAvg.textContent = (Math.round(s.avgEvaluados * 10) / 10) + ' %';
      detailOwnAvg.textContent = (Math.round(s.avgOwn * 10) / 10) + ' %';

      // start cycling comments one by one every 2s
      detailComments.innerHTML = '';
      currentCommentIndex = 0;
      if(s.comments.length){
        detailComments.innerHTML = `<div class="comment">${s.comments[0]}</div>`;
        currentCommentIndex = 1;
        detailCommentInterval = setInterval(()=> {
          const comm = s.comments[currentCommentIndex % s.comments.length];
          detailComments.innerHTML = `<div class="comment">${comm}</div>`;
          currentCommentIndex++;
        }, 2000);
      } else {
        detailComments.innerHTML = '<div class="muted">No hay comentarios.</div>';
      }
    }

    function stopDetailCommentsCycle(){
      if(detailCommentInterval){
        clearInterval(detailCommentInterval);
        detailCommentInterval = null;
      }
    }

    function hideDetail(){
      stopDetailCommentsCycle();
      detailCardEl.style.display = 'none';
      noSelectionNote.style.display = 'none';
      // also clear selection highlight
      document.querySelectorAll('.student-row').forEach(r => r.classList.remove('selected'));
      selectedStudentId = null;
      // clear detail content
      detailComments.innerHTML = '';
      detailName.textContent = '';
      detailSchool.textContent = '';
      detailEvalCount.textContent = '‚Äî';
      detailEvalAvg.textContent = '‚Äî';
      detailOwnAvg.textContent = '‚Äî';
    }

    /***********************
     * OPTION 2: statistics
     ***********************/
    function mean(arr){
      if(!arr.length) return 0;
      return arr.reduce((a,b)=>a+b,0)/arr.length;
    }
    function median(arr){
      if(!arr.length) return 0;
      const a = [...arr].sort((x,y)=>x-y);
      const mid = Math.floor(a.length/2);
      return a.length % 2 === 0 ? (a[mid-1]+a[mid])/2 : a[mid];
    }

    function renderStats(){
      const tbody = document.getElementById('statsTbody');
      tbody.innerHTML = '';
      const arrOwn = students.map(s => s.avgOwn);
      const arrEvalAvg = students.map(s => s.avgEvaluados);

      const gMean = mean(arrOwn).toFixed(1);
      const gMedian = median(arrOwn).toFixed(1);
      document.getElementById('globalMean').textContent = gMean + ' %';
      document.getElementById('globalMedian').textContent = gMedian + ' %';
      document.getElementById('globalExtra').textContent = `Basado en ${students.length} estudiantes`;

      students.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><strong>${s.name}</strong><div class="muted" style="font-size:13px">${s.school}</div></td>
                        <td>${s.avgOwn.toFixed(1)} %</td>
                        <td>${s.avgEvaluados.toFixed(1)} %</td>
                        <td>${median([s.avgEvaluados]).toFixed(1)} %</td>`;
        tbody.appendChild(tr);
      });
    }

    /***********************
     * OPTION 3: comments sequential cards (global)
     * - keep max 6 cards in the grid; when adding the 7th remove the oldest
     ***********************/
    function renderCommentsSequential(){
      const grid = document.getElementById('commentsGrid');
      grid.innerHTML = '';
      // build flat list of comments with author
      const all = [];
      students.forEach(s => {
        s.comments.forEach(c => all.push({author: s.name, school: s.school, text: c}));
      });
      let idx = 0;
      if(all.length === 0) {
        grid.innerHTML = '<div class="muted-note">No hay comentarios disponibles.</div>';
        return;
      }
      // append one every 2 seconds; keep maximum 6 cards in grid
      commentsGridInterval = setInterval(()=> {
        if(idx >= all.length){
          // stop when done
          clearInterval(commentsGridInterval);
          commentsGridInterval = null;
          return;
        }
        const item = all[idx];
        const card = document.createElement('div');
        card.className = 'card-comment';
        card.innerHTML = `<div style="font-weight:700">${item.author}</div>
                          <div class="muted" style="font-size:13px">${item.school}</div>
                          <div style="margin-top:8px">${item.text}</div>`;

        // if grid already has 6 cards, remove the oldest (first) before appending
        if(grid.children.length >= 6){
          grid.removeChild(grid.firstElementChild);
        }

        grid.appendChild(card);
        idx++;
      }, 2000);
    }

    /***********************
     * Initialize: on load show nothing in right container
     ***********************/
    (function init(){
      // ensure no section visible initially
      hideAllSections();
      // Do not auto-open any section ‚Äî user must click a menu option.
    })();

    /***********************
     * Clean up intervals on unload
     ***********************/
    window.addEventListener('beforeunload', ()=> {
      clearAllIntervals();
    });
  </script>
</body>
</html>
